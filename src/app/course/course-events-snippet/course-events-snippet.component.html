<ng-container *ngIf="user?.is_teacher">
    <a
        tuiButton
        appearance="primary"
        size="m"
        icon="tuiIconPlus"
        [routerLink]="['/course', courseId, 'new-event']"
    >
        Add an Event
    </a>
    <button
        tuiButton
        appearance="primary"
        size="m"
        icon="tuiIconDownload"
        (click)="openEventImportDialog()"
    >
        Import an Event
    </button>
</ng-container>
<hr/>
<table tuiTable>
    <thead tuiThead>
    <tr tuiThGroup>
        <th tuiTh *tuiHead="'name'">Name</th>
        <th tuiTh *tuiHead="'start_date'">Start&nbsp;Date</th>
        <th tuiTh *tuiHead="'end_date'">End&nbsp;Date</th>
        <th tuiTh *tuiHead="'grade'">Grade</th>
        <th tuiTh *tuiHead="'actions'">Actions</th>
    </tr>
    </thead>
    <tbody tuiTbody>
    <ng-container *ngIf="events; else tableEmpty">
        <ng-container *ngFor="let event of events; index as i">
            <tr tuiTr *tuiRow="let event of events; index as i">
                <td>{{ event.name || 'N/A'}}</td>
                <td>{{ event.start_date | date: 'LLL. dd, YYYY, hh:MM a' || 'No Date'}}</td>
                <td>{{ event.end_date | date: 'LLL. dd, YYYY, hh:MM a' || 'No Date'}}</td>
                <td *ngIf="isExamAndOpen(event); else totalEventGrade">Not Available Yet</td>
                <ng-template #totalEventGrade>
                    <td>{{ event.total_event_grade | number: '1.0-1' || 'No Grade'}}%</td>
                </ng-template>
                <td>
                    <div class="btn-container">
                        <ng-container *ngIf="event.is_allowed_to_open || user?.is_teacher; else notAllowedOpen">
                            <a [routerLink]="['/course', courseId, 'event', event.id]"
                               class="btn btn-primary mr-3">{{ getEventButtonText(event) }}</a>
                        </ng-container>
                        <ng-template #notAllowedOpen>
                            <!--Link to nowhere if you can't open. It's disabled however-->
                            <a class="btn btn-outline-info open-btn mr-3 disabled"
                               href="#">{{ getEventButtonText(event) }}</a>
                        </ng-template>
                        <a *ngIf="event.has_edit_permission" [routerLink]="['/course', courseId, 'new-event', event.id]"
                           class="btn btn-primary edit-btn">Edit</a>
                    </div>
                </td>
            </tr>
        </ng-container>
    </ng-container>
    <ng-template #tableEmpty>
        <tr>
            <td class="bg-info" colspan="6">
                <p class="text-center text-light m-0">There are currently no events in this course.</p>
            </td>
        </tr>
    </ng-template>
    </tbody>
</table>
<ng-template
    let-observer
    [tuiDialogOptions]="{ label: 'Select an Event to Import', size: 'l' }"
    [(tuiDialog)]="openImportDialog"
>
    <ng-container *ngIf="courseEvents">
        <table tuiTable [columns]="courseEventHeadings" class="table tui-space_top-8">
            <thead tuiThead>
            <tr tuiThGroup>
                <th *tuiHead="'id'" tuiTh>Id</th>
                <th *tuiHead="'name'" tuiTh>Name</th>
                <th *tuiHead="'type'" tuiTh>Type</th>
                <th *tuiHead="'course'" tuiTh>Course Id</th>
                <th *tuiHead="'actions'" tuiTh [sorter]="null">Actions</th>
            </tr>
            </thead>
            <tbody tuiTbody [data]="courseEvents">
            <tr tuiTr *tuiRow="let event of courseEvents">
                <td tuiTd *tuiCell="'actions'">
                    <button
                        tuiButton
                        appearance="primary"
                        size="s"
                        icon="tuiIconDownload"
                        (click)="importCourseEvent(event, courseId)"
                    >
                        Import
                    </button>
                </td>
            </tr>
            </tbody>
        </table>
    </ng-container>
    <button tuiButton type="button" size="m" class="tui-space_top-4" (click)="observer.complete()">
        Cancel
    </button>
</ng-template>
