<div class="practice">
    <aside class="practice-sidebar tui-container tui-container_fullwidth">
        <div class="practice-sidebar_content tui-space_top-6">
            <div
                class="practice-sidebar_content-breadcrumbs tui-space_bottom-2"
                *ngIf="parentCategory"
            >
                <a
                    tuiLink
                    class="tui-space_vertical-0"
                    [class.tui-skeleton]="!category"
                    [class.tui-skeleton_text]="!category"
                    [routerLink]="['../', parentCategory?.pk]"
                >
                    {{parentCategory?.name}}
                </a>
                <tui-svg
                    src="tuiIconChevronRight"
                    [class.tui-skeleton]="!category"
                ></tui-svg>
            </div>
            <tui-hosted-dropdown class="tui-space_bottom-2" [content]="categoryDropdown">
                <button
                    class="practice-sidebar_content-categories_button tui-text_h6"
                    [class.tui-skeleton]="!category"
                >
                    {{!parentCategory ? 'All ' : ''}}{{category?.name ?? 'Category Name'}}
                </button>
            </tui-hosted-dropdown>
            <ng-template #categoryDropdown>
                <tui-data-list role="menu">
                    <tui-opt-group
                        *ngFor="let parentCategory of nestedCategories"
                        [label]="parentCategory.category.name"
                    >
                        <a
                            #rla="routerLinkActive"
                            tuiOption
                            role="menuitemradio"
                            routerLinkActive
                            [attr.aria-checked]="rla.isActive"
                            [routerLink]="['../', parentCategory.category.pk]"
                        >
                            All&nbsp;{{parentCategory.category.name}}
                            <tui-svg *ngIf="rla.isActive" src="tuiIconCheckLarge"></tui-svg>
                        </a>
                        <a
                            *ngFor="let childrenCategory of parentCategory.children"
                            #rla="routerLinkActive"
                            tuiOption
                            role="menuitemradio"
                            routerLinkActive
                            [attr.aria-checked]="rla.isActive"
                            [routerLink]="['../', childrenCategory.category.pk]"
                        >
                            {{childrenCategory.category.full_name}}
                            <tui-svg *ngIf="rla.isActive" src="tuiIconCheckLarge"></tui-svg>
                        </a>
                    </tui-opt-group>
                </tui-data-list>
            </ng-template>
            <p
                class="tui-space_bottom-0"
                [class.tui-skeleton]="!category || !userDifficultyStats"
                [class.tui-skeleton_text]="!category || !userDifficultyStats"
            >
                Your Success Rate: {{(userSuccessRate * 100).toFixed(2) + '%' || 'N/A'}}
            </p>
            <p
                class="tui-space_top-1"
                [class.tui-skeleton]="!category || !userDifficultyStats"
                [class.tui-skeleton_text]="!category || !userDifficultyStats"
            >
                Average Success Rate: {{(category?.average_success * 100).toFixed(2) + '%' || 'N/A'}}
            </p>
            <tui-select
                [tuiTextfieldCleaner]="true"
                [valueContent]="difficulties ? (difficulties | stringifyTuiDataList: 0: 1) : ''"
                (ngModelChange)="updateQuestions($event, include_solved)"
                [ngModel]="difficulty"
                tuiTextfieldSize="m"
                [class.tui-skeleton]="!difficulties || !category"
            >
                Choose a level of difficulty
                <tui-data-list *tuiDataList>
                    <button *ngFor="let diff of difficulties" tuiOption [value]="diff[0]">
                        {{ diff[1] }}
                    </button>
                </tui-data-list>
            </tui-select>
            <tui-checkbox-labeled
                [ngModel]="include_solved"
                (ngModelChange)="updateQuestions(difficulty, $event)"
                class="tui-space_top-4"
                [class.tui-skeleton]="!difficulties || !category"
            >
                Include Solved
            </tui-checkbox-labeled>
        </div>
        <div class="practice-sidebar_buttons tui-space_vertical-6">
            <button
                tuiButton
                size="s"
                icon="tuiIconArrowLeft"
                (click)="prevQuestion()"
                [class.tui-skeleton]="!category || !uqjs"
            >
                Previous Question
            </button>
            <button
                tuiButton
                size="s"
                (click)="nextQuestion()"
                iconRight="tuiIconArrowRight"
                [class.tui-skeleton]="!category || !uqjs"
            >
                Next Question
            </button>
        </div>
    </aside>
    <div class="practice-content">
        <app-problem-view
            *ngIf="currentQuestionId && category && uqjs else noProblems"
            [questionId]="currentQuestionId"
        ></app-problem-view>
        <ng-template #noProblems>
            <div class="tui-container tui-container_fullwidth practice-content_none">
                <tui-marker-icon
                    src="tuiIconAlertCircleLarge"
                    mode="error"
                    size="s"
                    class="tui-space_bottom-4"
                    [class.tui-skeleton]="!category || !uqjs"
                ></tui-marker-icon>
                <h1
                    class="tui-text_h6"
                    [class.tui-skeleton]="!category || !uqjs"
                >
                    There are no available practice questions for this category/difficulty.
                </h1>
            </div>
        </ng-template>
    </div>
</div>
